# next-typed-codegen-route

Type-safe route codegen for Next.js App Router. Scan your `app` directory and generate typed route paths with full TypeScript inference.

## Features

- **Zero dependency** - Use with `npx` only, no need to install as a dependency
- **Type-safe path builder** - `path("/user/[id]", { id: "123" })` with full TypeScript inference
- **Route utilities** - `getAllRoutes()`, `getRoute()`, `getRouteByPathname()` with dynamic config loading
- **createRoute/createDynamicRoute** - Attach meta and validators to your page components
- **Flexible filtering** - Exclude parallel routes, route groups, or specific patterns

## Quick Start

### 1. Initialize (one-time setup)

```bash
npx next-typed-codegen-route init
```

This generates all static files in `.generated/next-typed-codegen-route/`:
- `route-meta.ts` - Type definitions (RouteMeta, validators, etc.)
- `create-route.ts` - createRoute/createDynamicRoute functions
- `types.ts` - Route type placeholders
- `routes.ts` - Route data placeholders
- `utils.ts` - Utility functions (path, getAllRoutes, getRoute, etc.)
- `index.ts` - Re-exports everything

### 2. Generate route types

```bash
npx next-typed-codegen-route generate
```

This updates `types.ts` and `routes.ts` based on your `src/app` directory.

Add to your build script:

```json
{
  "scripts": {
    "prebuild": "npx next-typed-codegen-route generate",
    "dev": "npx next-typed-codegen-route generate && next dev"
  }
}
```

### 3. Use in your pages

```tsx
// src/app/user/[id]/page.tsx
import { createDynamicRoute } from "@/.generated/next-typed-codegen-route";

async function UserPage({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params;
  return <div>User {id}</div>;
}

export default createDynamicRoute({
  component: UserPage,
  meta: {
    title: "User Profile",
  },
});
```

### 4. Use generated utilities

```tsx
import { path, getAllRoutes, getRoute, getRouteByPathname } from "@/.generated/next-typed-codegen-route";

// Type-safe path builder
const userUrl = path("/user/[id]", { id: "123" });
// => "/user/123"

// Get all routes (async - includes config)
const routes = await getAllRoutes();
// => [{ href: "/", isStatic: true, params: [], config: {...} }, ...]

// Get all routes (sync - without config)
const routesSync = getAllRoutes({ dynamic: false });
// => [{ href: "/", isStatic: true, params: [] }, ...]

// Get specific route by href
const route = await getRoute("/user/[id]");
// => { href: "/user/[id]", isStatic: false, params: ["id"], config: {...} }

// Get route by actual pathname
const matched = await getRouteByPathname("/user/123");
// => { href: "/user/[id]", isStatic: false, params: { id: "123" }, config: {...} }
```

## Configuration

Create `route-codegen.config.ts` in your project root (auto-generated by `init`):

```ts
import type { RouteCodegenConfig } from "./.generated/next-typed-codegen-route";

const config: RouteCodegenConfig = {
  // App directory to scan (default: "src/app")
  appDir: "src/app",

  // Output directory for generated files (default: ".generated/next-typed-codegen-route")
  outputDir: ".generated/next-typed-codegen-route",

  // Exclude specific paths
  excludePath: (path) => {
    // Exclude parallel routes @modal, route groups (auth)
    return /[@(]/.test(path);
  },

  // Sort routes alphabetically
  sortRoutes: (a, b) => a.routePath.localeCompare(b.routePath),
};

export default config;
```

## Generated Files

```
.generated/next-typed-codegen-route/
├── index.ts        # Re-exports everything
├── route-meta.ts   # RouteMeta, validators, component types, RouteCodegenConfig
├── create-route.ts # createRoute(), createDynamicRoute()
├── types.ts        # RouteHref, StaticRouteHref, DynamicRouteHref, RouteParamsMap
├── routes.ts       # ROUTES, ROUTE_INFO, ROUTE_CONFIGS, DYNAMIC_ROUTE_PATTERNS
└── utils.ts        # path(), getAllRoutes(), getRoute(), getRouteByPathname(), etc.
```

## CLI Commands

```bash
# Initialize static files (run once)
npx next-typed-codegen-route init

# Generate/update route types
npx next-typed-codegen-route generate

# Watch mode
npx next-typed-codegen-route watch

# Custom options
npx next-typed-codegen-route generate --app-dir app --output src/generated/routes

# Help
npx next-typed-codegen-route help
```

## TypeScript Configuration

Add the generated directory to your tsconfig paths:

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"],
      "@/.generated/*": ["./.generated/*"]
    }
  }
}
```

## Extending Route Meta

You can extend the `RouteMeta` interface for custom metadata:

```ts
// types/route-meta.d.ts
declare module "./.generated/next-typed-codegen-route" {
  interface RouteMeta {
    title?: string;
    description?: string;
    icon?: React.ComponentType;
  }
}
```

Then use with `createRoute`:

```tsx
import { createRoute } from "@/.generated/next-typed-codegen-route";

async function AboutPage() {
  return <div>About</div>;
}

export default createRoute({
  component: AboutPage,
  meta: {
    title: "About Us",
    description: "Learn more about us",
  },
});
```

## Using Validators

```tsx
import { createDynamicRoute } from "@/.generated/next-typed-codegen-route";
import { z } from "zod";

const paramsSchema = z.object({
  id: z.string().regex(/^\d+$/),
});

async function UserPage({ params }: { params: Promise<z.infer<typeof paramsSchema>> }) {
  const { id } = await params;
  return <div>User {id}</div>;
}

export default createDynamicRoute({
  component: UserPage,
  validator: {
    params: (raw) => paramsSchema.parse(raw),
  },
});
```

## License

MIT
